<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Progress Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-image: url('https://images.unsplash.com/photo-1571902943202-507ec2618e8f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1075&q=80');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .btn-hover {
            transition: all 0.3s ease;
        }
        
        .btn-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .toggle-checkbox:checked {
            right: 0;
            background-color: #4f46e5;
        }
        
        .toggle-checkbox:checked + .toggle-label {
            background-color: #4f46e5;
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-800">Gym Progress Tracker</h1>
            <div class="flex items-center">
                <span class="mr-2 text-sm font-medium text-gray-700">Dark Mode</span>
                <div class="relative inline-block w-10 mr-2 align-middle select-none">
                    <input type="checkbox" name="toggle" id="toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                    <label for="toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                </div>
                <button id="summaryBtn" class="bg-indigo-600 text-white px-3 py-1 rounded-lg text-sm btn-hover">Weekly Summary</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Workout Logging -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Today's Workout Info -->
                <div class="glass-card p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-700" id="todayWorkoutTitle">Today's Workout</h2>
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mr-4">
                            <span class="text-indigo-600 font-bold" id="workoutDayShort">Mon</span>
                        </div>
                        <div>
                            <h3 class="font-medium" id="workoutDayFull">Monday</h3>
                            <p class="text-sm text-gray-600" id="muscleGroups">Chest & Triceps</p>
                        </div>
                    </div>
                    <div class="text-sm">
                        <p class="mb-1"><span class="font-medium">Date:</span> <span id="currentDate">Loading...</span></p>
                        <p class="mb-1"><span class="font-medium">Last Workout:</span> <span id="lastWorkoutDate">Never</span></p>
                        <p><span class="font-medium">Progress Streak:</span> <span id="progressStreak">0 days</span></p>
                    </div>
                </div>

                <!-- Workout Logging Form -->
                <div class="glass-card p-6 fade-in">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-700">Log Workout</h2>
                    <form id="workoutForm" class="space-y-4">
                        <div>
                            <label for="exercise" class="block text-sm font-medium text-gray-700 mb-1">Exercise</label>
                            <input type="text" id="exercise" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <div id="exerciseSuggestions" class="mt-1 space-y-1 hidden"></div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label for="sets" class="block text-sm font-medium text-gray-700 mb-1">Sets</label>
                                <input type="number" id="sets" min="1" max="20" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="reps" class="block text-sm font-medium text-gray-700 mb-1">Reps</label>
                                <input type="number" id="reps" min="1" max="50" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                                <input type="number" id="weight" min="0" step="0.5" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            </div>
                        </div>
                        
                        <div>
                            <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                            <textarea id="notes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                        </div>
                        
                        <div id="weightSuggestion" class="text-sm p-2 bg-indigo-50 rounded-md hidden"></div>
                        
                        <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-300 btn-hover">Save Workout</button>
                    </form>
                </div>
            </div>

            <!-- Middle Column - Workout History -->
            <div class="lg:col-span-1">
                <div class="glass-card p-6 h-full fade-in">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-indigo-700">Workout History</h2>
                        <div class="flex space-x-2">
                            <button id="exportCSV" class="bg-green-600 text-white px-3 py-1 rounded-lg text-sm btn-hover">Export CSV</button>
                            <button id="exportJSON" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm btn-hover">Export JSON</button>
                            <button id="importJSON" class="bg-purple-600 text-white px-3 py-1 rounded-lg text-sm btn-hover">Import</button>
                            <input type="file" id="jsonFileInput" class="hidden" accept=".json">
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="historyFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by Exercise</label>
                        <select id="historyFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">All Exercises</option>
                        </select>
                    </div>
                    
                    <div class="overflow-y-auto max-h-[600px] pr-2">
                        <div id="workoutHistory" class="space-y-4">
                            <!-- Workout entries will be added here dynamically -->
                            <p class="text-gray-500 text-center py-4">No workout history yet. Start logging your workouts!</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Progress Chart -->
            <div class="lg:col-span-1">
                <div class="glass-card p-6 h-full fade-in">
                    <h2 class="text-xl font-semibold mb-4 text-indigo-700">Progress Chart</h2>
                    
                    <div class="mb-4">
                        <label for="chartExercise" class="block text-sm font-medium text-gray-700 mb-1">Select Exercise</label>
                        <select id="chartExercise" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                            <option value="">Select an exercise</option>
                        </select>
                    </div>
                    
                    <div class="relative h-64 md:h-80">
                        <canvas id="progressChart"></canvas>
                    </div>
                    
                    <div class="mt-4 flex justify-end">
                        <button id="exportPDF" class="bg-red-600 text-white px-3 py-1 rounded-lg text-sm btn-hover">Export PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Summary Modal -->
    <div id="summaryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="glass-card p-6 max-w-md w-full mx-4 fade-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-indigo-700">Weekly Summary</h3>
                <button id="closeSummary" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="summaryContent" class="space-y-3">
                <!-- Summary content will be added here dynamically -->
                <p>Loading weekly summary...</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Main application class
            class GymTracker {
                constructor() {
                    this.workouts = JSON.parse(localStorage.getItem('workouts')) || [];
                    this.workoutSchedule = {
                        '0': { day: 'Sunday', muscleGroup: 'Rest', short: 'Sun' },
                        '1': { day: 'Monday', muscleGroup: 'Chest & Triceps', short: 'Mon' },
                        '2': { day: 'Tuesday', muscleGroup: 'Legs', short: 'Tue' },
                        '3': { day: 'Wednesday', muscleGroup: 'Shoulders & Forearms', short: 'Wed' },
                        '4': { day: 'Thursday', muscleGroup: 'Back & Biceps', short: 'Thu' },
                        '5': { day: 'Friday', muscleGroup: 'Chest & Triceps', short: 'Fri' },
                        '6': { day: 'Saturday', muscleGroup: 'Shoulders', short: 'Sat' }
                    };
                    
                    this.currentDate = new Date();
                    this.currentDay = this.currentDate.getDay();
                    
                    this.initElements();
                    this.initEventListeners();
                    this.updateUI();
                    this.initChart();
                    this.updateExerciseLists();
                    this.calculateStreak();
                }
                
                // Initialize DOM elements
                initElements() {
                    this.elements = {
                        todayWorkoutTitle: document.getElementById('todayWorkoutTitle'),
                        workoutDayShort: document.getElementById('workoutDayShort'),
                        workoutDayFull: document.getElementById('workoutDayFull'),
                        muscleGroups: document.getElementById('muscleGroups'),
                        currentDate: document.getElementById('currentDate'),
                        lastWorkoutDate: document.getElementById('lastWorkoutDate'),
                        progressStreak: document.getElementById('progressStreak'),
                        workoutForm: document.getElementById('workoutForm'),
                        exercise: document.getElementById('exercise'),
                        sets: document.getElementById('sets'),
                        reps: document.getElementById('reps'),
                        weight: document.getElementById('weight'),
                        notes: document.getElementById('notes'),
                        exerciseSuggestions: document.getElementById('exerciseSuggestions'),
                        weightSuggestion: document.getElementById('weightSuggestion'),
                        workoutHistory: document.getElementById('workoutHistory'),
                        historyFilter: document.getElementById('historyFilter'),
                        chartExercise: document.getElementById('chartExercise'),
                        progressChart: document.getElementById('progressChart'),
                        exportCSV: document.getElementById('exportCSV'),
                        exportJSON: document.getElementById('exportJSON'),
                        importJSON: document.getElementById('importJSON'),
                        jsonFileInput: document.getElementById('jsonFileInput'),
                        exportPDF: document.getElementById('exportPDF'),
                        summaryModal: document.getElementById('summaryModal'),
                        summaryBtn: document.getElementById('summaryBtn'),
                        closeSummary: document.getElementById('closeSummary'),
                        summaryContent: document.getElementById('summaryContent'),
                        toggle: document.getElementById('toggle')
                    };
                }
                
                // Initialize event listeners
                initEventListeners() {
                    // Form submission
                    this.elements.workoutForm.addEventListener('submit', (e) => this.handleFormSubmit(e));
                    
                    // Exercise input for suggestions
                    this.elements.exercise.addEventListener('input', () => this.showExerciseSuggestions());
                    
                    // History filter change
                    this.elements.historyFilter.addEventListener('change', () => this.filterWorkoutHistory());
                    
                    // Chart exercise selection
                    this.elements.chartExercise.addEventListener('change', () => this.updateChart());
                    
                    // Data export/import
                    this.elements.exportCSV.addEventListener('click', () => this.exportToCSV());
                    this.elements.exportJSON.addEventListener('click', () => this.exportToJSON());
                    this.elements.importJSON.addEventListener('click', () => this.elements.jsonFileInput.click());
                    this.elements.jsonFileInput.addEventListener('change', (e) => this.importFromJSON(e));
                    this.elements.exportPDF.addEventListener('click', () => this.exportToPDF());
                    
                    // Summary modal
                    this.elements.summaryBtn.addEventListener('click', () => this.showSummary());
                    this.elements.closeSummary.addEventListener('click', () => this.hideSummary());
                    
                    // Dark mode toggle
                    this.elements.toggle.addEventListener('change', () => this.toggleDarkMode());
                    
                    // Check if dark mode was previously enabled
                    if (localStorage.getItem('darkMode') === 'enabled') {
                        document.documentElement.classList.add('dark');
                        this.elements.toggle.checked = true;
                    }
                }
                
                // Update UI elements
                updateUI() {
                    const today = this.workoutSchedule[this.currentDay.toString()];
                    
                    // Update today's workout info
                    this.elements.workoutDayShort.textContent = today.short;
                    this.elements.workoutDayFull.textContent = today.day;
                    this.elements.muscleGroups.textContent = today.muscleGroup;
                    
                    // Format current date
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    this.elements.currentDate.textContent = this.currentDate.toLocaleDateString(undefined, options);
                    
                    // Update last workout date
                    if (this.workouts.length > 0) {
                        const lastWorkout = this.workouts[this.workouts.length - 1];
                        const lastDate = new Date(lastWorkout.date);
                        this.elements.lastWorkoutDate.textContent = lastDate.toLocaleDateString();
                    }
                    
                    // Update workout history
                    this.updateWorkoutHistory();
                }
                
                // Initialize Chart.js chart
                initChart() {
                    this.chart = new Chart(this.elements.progressChart, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Weight (kg)',
                                data: [],
                                backgroundColor: 'rgba(79, 70, 229, 0.2)',
                                borderColor: 'rgba(79, 70, 229, 1)',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Weight (kg)'
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Date'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        afterLabel: function(context) {
                                            const workout = context.dataset.workouts[context.dataIndex];
                                            return `Sets: ${workout.sets}\nReps: ${workout.reps}`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Update exercise dropdown lists
                updateExerciseLists() {
                    // Get unique exercises from workout history
                    const exercises = [...new Set(this.workouts.map(w => w.exercise))].sort();
                    
                    // Update chart exercise dropdown
                    const chartExerciseSelect = this.elements.chartExercise;
                    chartExerciseSelect.innerHTML = '<option value="">Select an exercise</option>';
                    exercises.forEach(exercise => {
                        const option = document.createElement('option');
                        option.value = exercise;
                        option.textContent = exercise;
                        chartExerciseSelect.appendChild(option);
                    });
                    
                    // Update history filter dropdown
                    const historyFilterSelect = this.elements.historyFilter;
                    historyFilterSelect.innerHTML = '<option value="">All Exercises</option>';
                    exercises.forEach(exercise => {
                        const option = document.createElement('option');
                        option.value = exercise;
                        option.textContent = exercise;
                        historyFilterSelect.appendChild(option);
                    });
                }
                
                // Handle form submission
                handleFormSubmit(e) {
                    e.preventDefault();
                    
                    const today = this.workoutSchedule[this.currentDay.toString()];
                    
                    if (today.muscleGroup === 'Rest') {
                        alert("Today is a rest day! No workouts to log.");
                        return;
                    }
                    
                    const workout = {
                        id: Date.now(),
                        date: this.currentDate.toISOString(),
                        day: today.day,
                        muscleGroup: today.muscleGroup,
                        exercise: this.elements.exercise.value.trim(),
                        sets: parseInt(this.elements.sets.value),
                        reps: parseInt(this.elements.reps.value),
                        weight: parseFloat(this.elements.weight.value),
                        notes: this.elements.notes.value.trim()
                    };
                    
                    this.workouts.push(workout);
                    this.saveWorkouts();
                    
                    // Reset form
                    this.elements.workoutForm.reset();
                    this.elements.weightSuggestion.classList.add('hidden');
                    
                    // Update UI
                    this.updateUI();
                    this.updateExerciseLists();
                    this.updateChart();
                    this.calculateStreak();
                }
                
                // Save workouts to localStorage
                saveWorkouts() {
                    localStorage.setItem('workouts', JSON.stringify(this.workouts));
                }
                
                // Show exercise suggestions based on input
                showExerciseSuggestions() {
                    const input = this.elements.exercise.value.trim().toLowerCase();
                    if (input.length < 2) {
                        this.elements.exerciseSuggestions.classList.add('hidden');
                        this.elements.weightSuggestion.classList.add('hidden');
                        return;
                    }
                    
                    // Get unique exercises that match input
                    const suggestions = [...new Set(this.workouts
                        .map(w => w.exercise)
                        .filter(ex => ex.toLowerCase().includes(input)))
                    ].slice(0, 5);
                    
                    const suggestionsContainer = this.elements.exerciseSuggestions;
                    suggestionsContainer.innerHTML = '';
                    
                    if (suggestions.length > 0) {
                        suggestions.forEach(exercise => {
                            const div = document.createElement('div');
                            div.className = 'px-2 py-1 hover:bg-indigo-100 rounded cursor-pointer';
                            div.textContent = exercise;
                            div.addEventListener('click', () => {
                                this.elements.exercise.value = exercise;
                                suggestionsContainer.classList.add('hidden');
                                this.showWeightSuggestion(exercise);
                            });
                            suggestionsContainer.appendChild(div);
                        });
                        suggestionsContainer.classList.remove('hidden');
                    } else {
                        suggestionsContainer.classList.add('hidden');
                    }
                }
                
                // Show weight suggestion for selected exercise
                showWeightSuggestion(exercise) {
                    const exerciseWorkouts = this.workouts
                        .filter(w => w.exercise === exercise)
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    if (exerciseWorkouts.length < 2) {
                        this.elements.weightSuggestion.classList.add('hidden');
                        return;
                    }
                    
                    const lastWorkout = exerciseWorkouts[0];
                    const secondLastWorkout = exerciseWorkouts[1];
                    
                    // Check if last two workouts had same sets, reps and weight
                    if (lastWorkout.sets === secondLastWorkout.sets && 
                        lastWorkout.reps === secondLastWorkout.reps && 
                        lastWorkout.weight === secondLastWorkout.weight) {
                        
                        const suggestedWeight = lastWorkout.weight + 2.5;
                        this.elements.weightSuggestion.innerHTML = `
                            <strong>Progression Suggestion:</strong> Try increasing weight to <strong>${suggestedWeight}kg</strong> 
                            for your next workout (same sets/reps).
                        `;
                        this.elements.weightSuggestion.classList.remove('hidden');
                        
                        // Auto-fill the weight field with suggestion
                        this.elements.weight.value = suggestedWeight;
                    } else {
                        this.elements.weightSuggestion.classList.add('hidden');
                    }
                }
                
                // Update workout history display
                updateWorkoutHistory(filterExercise = '') {
                    const historyContainer = this.elements.workoutHistory;
                    historyContainer.innerHTML = '';
                    
                    // Group workouts by date
                    const groupedWorkouts = {};
                    this.workouts
                        .filter(w => filterExercise === '' || w.exercise === filterExercise)
                        .forEach(workout => {
                            const date = new Date(workout.date).toDateString();
                            if (!groupedWorkouts[date]) {
                                groupedWorkouts[date] = [];
                            }
                            groupedWorkouts[date].push(workout);
                        });
                    
                    if (Object.keys(groupedWorkouts).length === 0) {
                        historyContainer.innerHTML = '<p class="text-gray-500 text-center py-4">No workout history found.</p>';
                        return;
                    }
                    
                    // Sort dates in descending order
                    const sortedDates = Object.keys(groupedWorkouts).sort((a, b) => new Date(b) - new Date(a));
                    
                    sortedDates.forEach(date => {
                        const dateHeader = document.createElement('div');
                        dateHeader.className = 'sticky top-0 bg-indigo-50 px-3 py-2 rounded-md shadow-sm z-10';
                        
                        const dateObj = new Date(date);
                        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                        dateHeader.textContent = dateObj.toLocaleDateString(undefined, options);
                        
                        historyContainer.appendChild(dateHeader);
                        
                        // Sort workouts by time (newest first)
                        groupedWorkouts[date].sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        groupedWorkouts[date].forEach(workout => {
                            const workoutCard = document.createElement('div');
                            workoutCard.className = 'bg-white p-4 rounded-md shadow-sm border border-gray-100 mt-2';
                            
                            const muscleGroup = document.createElement('div');
                            muscleGroup.className = 'text-xs font-medium text-indigo-600 mb-1';
                            muscleGroup.textContent = workout.muscleGroup;
                            
                            const exercise = document.createElement('h3');
                            exercise.className = 'font-semibold text-lg mb-1';
                            exercise.textContent = workout.exercise;
                            
                            const details = document.createElement('div');
                            details.className = 'flex justify-between text-sm mb-2';
                            details.innerHTML = `
                                <span><strong>Sets:</strong> ${workout.sets}</span>
                                <span><strong>Reps:</strong> ${workout.reps}</span>
                                <span><strong>Weight:</strong> ${workout.weight}kg</span>
                            `;
                            
                            const notes = document.createElement('p');
                            notes.className = 'text-gray-600 text-sm italic';
                            notes.textContent = workout.notes || 'No notes';
                            
                            const actions = document.createElement('div');
                            actions.className = 'flex justify-end space-x-2 mt-2';
                            
                            const editBtn = document.createElement('button');
                            editBtn.className = 'text-indigo-600 hover:text-indigo-800 text-sm btn-hover';
                            editBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg> Edit';
                            editBtn.addEventListener('click', () => this.editWorkout(workout.id));
                            
                            const deleteBtn = document.createElement('button');
                            deleteBtn.className = 'text-red-600 hover:text-red-800 text-sm btn-hover';
                            deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg> Delete';
                            deleteBtn.addEventListener('click', () => this.deleteWorkout(workout.id));
                            
                            actions.appendChild(editBtn);
                            actions.appendChild(deleteBtn);
                            
                            workoutCard.appendChild(muscleGroup);
                            workoutCard.appendChild(exercise);
                            workoutCard.appendChild(details);
                            workoutCard.appendChild(notes);
                            workoutCard.appendChild(actions);
                            
                            historyContainer.appendChild(workoutCard);
                        });
                    });
                }
                
                // Filter workout history by exercise
                filterWorkoutHistory() {
                    const filterExercise = this.elements.historyFilter.value;
                    this.updateWorkoutHistory(filterExercise);
                }
                
                // Edit a workout
                editWorkout(id) {
                    const workout = this.workouts.find(w => w.id === id);
                    if (!workout) return;
                    
                    // Fill form with workout data
                    this.elements.exercise.value = workout.exercise;
                    this.elements.sets.value = workout.sets;
                    this.elements.reps.value = workout.reps;
                    this.elements.weight.value = workout.weight;
                    this.elements.notes.value = workout.notes;
                    
                    // Remove the workout from the list
                    this.workouts = this.workouts.filter(w => w.id !== id);
                    this.saveWorkouts();
                    
                    // Update UI
                    this.updateUI();
                    this.updateExerciseLists();
                    this.updateChart();
                }
                
                // Delete a workout
                deleteWorkout(id) {
                    if (confirm('Are you sure you want to delete this workout?')) {
                        this.workouts = this.workouts.filter(w => w.id !== id);
                        this.saveWorkouts();
                        
                        // Update UI
                        this.updateUI();
                        this.updateExerciseLists();
                        this.updateChart();
                        this.calculateStreak();
                    }
                }
                
                // Update the progress chart
                updateChart() {
                    const exercise = this.elements.chartExercise.value;
                    if (!exercise) {
                        this.chart.data.labels = [];
                        this.chart.data.datasets[0].data = [];
                        this.chart.data.datasets[0].workouts = [];
                        this.chart.update();
                        return;
                    }
                    
                    // Filter workouts for selected exercise
                    const exerciseWorkouts = this.workouts
                        .filter(w => w.exercise === exercise)
                        .sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    if (exerciseWorkouts.length === 0) {
                        this.chart.data.labels = [];
                        this.chart.data.datasets[0].data = [];
                        this.chart.data.datasets[0].workouts = [];
                        this.chart.update();
                        return;
                    }
                    
                    // Prepare chart data
                    const labels = exerciseWorkouts.map(w => {
                        const date = new Date(w.date);
                        return date.toLocaleDateString();
                    });
                    
                    const data = exerciseWorkouts.map(w => w.weight);
                    
                    // Store workout objects for tooltips
                    this.chart.data.datasets[0].workouts = exerciseWorkouts;
                    
                    // Update chart
                    this.chart.data.labels = labels;
                    this.chart.data.datasets[0].data = data;
                    this.chart.update();
                }
                
                // Export workout data to CSV
                exportToCSV() {
                    if (this.workouts.length === 0) {
                        alert('No workout data to export.');
                        return;
                    }
                    
                    // CSV header
                    let csv = 'Date,Day,Muscle Group,Exercise,Sets,Reps,Weight (kg),Notes\n';
                    
                    // Add workout data
                    this.workouts.forEach(workout => {
                        const date = new Date(workout.date).toLocaleDateString();
                        const notes = workout.notes.replace(/"/g, '""'); // Escape quotes
                        csv += `"${date}","${workout.day}","${workout.muscleGroup}","${workout.exercise}",${workout.sets},${workout.reps},${workout.weight},"${notes}"\n`;
                    });
                    
                    // Create download link
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `gym_workouts_${new Date().toISOString().slice(0, 10)}.csv`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                
                // Export workout data to JSON
                exportToJSON() {
                    if (this.workouts.length === 0) {
                        alert('No workout data to export.');
                        return;
                    }
                    
                    const dataStr = JSON.stringify(this.workouts, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `gym_workouts_${new Date().toISOString().slice(0, 10)}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
                
                // Import workout data from JSON file
                importFromJSON(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedWorkouts = JSON.parse(e.target.result);
                            if (!Array.isArray(importedWorkouts)) {
                                throw new Error('Invalid data format');
                            }
                            
                            if (confirm(`Import ${importedWorkouts.length} workouts? This will replace your current data.`)) {
                                this.workouts = importedWorkouts;
                                this.saveWorkouts();
                                
                                // Update UI
                                this.updateUI();
                                this.updateExerciseLists();
                                this.updateChart();
                                this.calculateStreak();
                                
                                alert('Workouts imported successfully!');
                            }
                        } catch (error) {
                            alert('Error importing workouts: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                    
                    // Reset file input
                    event.target.value = '';
                }
                
                // Export chart to PDF
                exportToPDF() {
                    const exercise = this.elements.chartExercise.value;
                    if (!exercise) {
                        alert('Please select an exercise first.');
                        return;
                    }
                    
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Add title
                    doc.setFontSize(18);
                    doc.text(`Progress Report: ${exercise}`, 105, 20, { align: 'center' });
                    
                    // Add date
                    doc.setFontSize(12);
                    doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
                    
                    // Add chart image
                    const canvas = document.getElementById('progressChart');
                    const chartImage = canvas.toDataURL('image/png');
                    doc.addImage(chartImage, 'PNG', 15, 40, 180, 120);
                    
                    // Add workout summary
                    const exerciseWorkouts = this.workouts
                        .filter(w => w.exercise === exercise)
                        .sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    if (exerciseWorkouts.length > 0) {
                        const lastWorkout = exerciseWorkouts[0];
                        doc.setFontSize(14);
                        doc.text('Latest Workout:', 20, 170);
                        
                        doc.setFontSize(12);
                        doc.text(`Date: ${new Date(lastWorkout.date).toLocaleDateString()}`, 20, 180);
                        doc.text(`Sets: ${lastWorkout.sets}`, 20, 190);
                        doc.text(`Reps: ${lastWorkout.reps}`, 20, 200);
                        doc.text(`Weight: ${lastWorkout.weight}kg`, 20, 210);
                        
                        if (lastWorkout.notes) {
                            doc.text(`Notes: ${lastWorkout.notes}`, 20, 220);
                        }
                    }
                    
                    // Save PDF
                    doc.save(`gym_progress_${exercise}_${new Date().toISOString().slice(0, 10)}.pdf`);
                }
                
                // Show weekly summary modal
                showSummary() {
                    // Calculate weekly stats
                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                    
                    const recentWorkouts = this.workouts.filter(w => new Date(w.date) >= oneWeekAgo);
                    const workoutCount = recentWorkouts.length;
                    
                    // Calculate total volume (sets x reps x weight)
                    let totalVolume = 0;
                    recentWorkouts.forEach(w => {
                        totalVolume += w.sets * w.reps * w.weight;
                    });
                    
                    // Group by muscle group
                    const muscleGroupStats = {};
                    recentWorkouts.forEach(w => {
                        if (!muscleGroupStats[w.muscleGroup]) {
                            muscleGroupStats[w.muscleGroup] = 0;
                        }
                        muscleGroupStats[w.muscleGroup]++;
                    });
                    
                    // Prepare summary content
                    let summaryHTML = `
                        <div class="mb-4">
                            <h4 class="font-semibold text-lg mb-2">Weekly Overview</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-indigo-50 p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Workouts</p>
                                    <p class="text-2xl font-bold text-indigo-700">${workoutCount}</p>
                                </div>
                                <div class="bg-indigo-50 p-3 rounded-md">
                                    <p class="text-sm text-gray-600">Total Volume</p>
                                    <p class="text-2xl font-bold text-indigo-700">${totalVolume.toFixed(0)} kg</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    if (Object.keys(muscleGroupStats).length > 0) {
                        summaryHTML += `
                            <div class="mb-4">
                                <h4 class="font-semibold text-lg mb-2">Muscle Group Distribution</h4>
                                <div class="space-y-2">
                        `;
                        
                        for (const [group, count] of Object.entries(muscleGroupStats)) {
                            const percentage = (count / workoutCount * 100).toFixed(0);
                            summaryHTML += `
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>${group}</span>
                                        <span>${percentage}% (${count})</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-indigo-600 h-2 rounded-full" style="width: ${percentage}%"></div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        summaryHTML += `</div></div>`;
                    }
                    
                    if (recentWorkouts.length > 0) {
                        // Find most improved exercise (biggest weight increase)
                        const exerciseImprovements = {};
                        
                        recentWorkouts.forEach(w => {
                            if (!exerciseImprovements[w.exercise]) {
                                exerciseImprovements[w.exercise] = {
                                    firstWeight: w.weight,
                                    lastWeight: w.weight,
                                    count: 1
                                };
                            } else {
                                exerciseImprovements[w.exercise].lastWeight = w.weight;
                                exerciseImprovements[w.exercise].count++;
                            }
                        });
                        
                        let mostImproved = null;
                        let maxImprovement = 0;
                        
                        for (const [exercise, stats] of Object.entries(exerciseImprovements)) {
                            if (stats.count >= 2) {
                                const improvement = stats.lastWeight - stats.firstWeight;
                                if (improvement > maxImprovement) {
                                    maxImprovement = improvement;
                                    mostImproved = exercise;
                                }
                            }
                        }
                        
                        if (mostImproved) {
                            summaryHTML += `
                                <div class="bg-green-50 p-3 rounded-md border border-green-100">
                                    <h4 class="font-semibold text-lg mb-1 text-green-800">Most Improved</h4>
                                    <p class="text-green-700">${mostImproved} (+${maxImprovement.toFixed(1)}kg)</p>
                                </div>
                            `;
                        }
                    }
                    
                    this.elements.summaryContent.innerHTML = summaryHTML;
                    this.elements.summaryModal.classList.remove('hidden');
                }
                
                // Hide weekly summary modal
                hideSummary() {
                    this.elements.summaryModal.classList.add('hidden');
                }
                
                // Calculate workout streak
                calculateStreak() {
                    if (this.workouts.length === 0) {
                        this.elements.progressStreak.textContent = '0 days';
                        return;
                    }
                    
                    // Sort workouts by date (newest first)
                    const sortedWorkouts = [...this.workouts].sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    let streak = 0;
                    let currentDate = new Date();
                    currentDate.setHours(0, 0, 0, 0);
                    
                    // Check if today has a workout
                    const todayWorkout = sortedWorkouts.find(w => {
                        const workoutDate = new Date(w.date);
                        workoutDate.setHours(0, 0, 0, 0);
                        return workoutDate.getTime() === currentDate.getTime();
                    });
                    
                    if (todayWorkout) {
                        streak = 1;
                    }
                    
                    // Check previous days
                    for (let i = todayWorkout ? 1 : 0; i < sortedWorkouts.length; i++) {
                        const workoutDate = new Date(sortedWorkouts[i].date);
                        workoutDate.setHours(0, 0, 0, 0);
                        
                        const prevDate = new Date(currentDate);
                        prevDate.setDate(prevDate.getDate() - 1);
                        prevDate.setHours(0, 0, 0, 0);
                        
                        if (workoutDate.getTime() === prevDate.getTime()) {
                            streak++;
                            currentDate = prevDate;
                        } else {
                            break; // Streak broken
                        }
                    }
                    
                    this.elements.progressStreak.textContent = `${streak} day${streak !== 1 ? 's' : ''}`;
                }
                
                // Toggle dark mode
                toggleDarkMode() {
                    if (this.elements.toggle.checked) {
                        document.documentElement.classList.add('dark');
                        localStorage.setItem('darkMode', 'enabled');
                    } else {
                        document.documentElement.classList.remove('dark');
                        localStorage.setItem('darkMode', 'disabled');
                    }
                }
            }
            
            // Initialize the application
            const gymTracker = new GymTracker();
        });
    </script>
</body>
</html>
